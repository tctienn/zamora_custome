<template>
  <TabView
    scrollable
    style='width: 18rem'
    @keydown='handleKeyDown'
    @keydown.enter='handleEnter'
    @tab-change='focusWhenChangeTab'>
    <TabPanel :header='`${t("chat.emoji.face")} 1`'>
      <div class='emoji text-xl'>
        <p>
          <span tabindex='1'>ğŸ˜€</span><span tabindex='2'>ğŸ˜ƒ</span><span tabindex='3'>ğŸ˜„</span>
          <span tabindex='4'>ğŸ˜</span><span tabindex='5'>ğŸ˜†</span>
          <span tabindex='6'>ğŸ˜…</span><span tabindex='7'>ğŸ˜‚</span><span tabindex='8'>ğŸ¤£</span>
          <span tabindex='9'>ğŸ¥²</span><span tabindex='10'>ğŸ¥¹</span>
        </p>

        <p>
          <span tabindex='11'>â˜ºï¸</span><span tabindex='12'>ğŸ˜Š</span><span tabindex='13'>ğŸ˜‡</span>
          <span tabindex='14'>ğŸ™‚</span><span tabindex='15'>ğŸ™ƒ</span>
          <span tabindex='16'>ğŸ˜‰</span><span tabindex='17'>ğŸ˜Œ</span><span tabindex='18'>ğŸ˜</span>
          <span tabindex='19'>ğŸ¥°</span><span tabindex='20'>ğŸ˜˜</span>
        </p>

        <p>
          <span tabindex='21'>ğŸ˜—</span><span tabindex='22'>ğŸ˜™</span><span tabindex='23'>ğŸ˜š</span>
          <span tabindex='24'>ğŸ˜‹</span><span tabindex='25'>ğŸ˜›</span>
          <span tabindex='26'>ğŸ˜</span><span tabindex='27'>ğŸ˜œ</span><span tabindex='28'>ğŸ¤ª</span>
          <span tabindex='29'>ğŸ¤¨</span><span tabindex='30'>ğŸ§</span>
        </p>

        <p>
          <span tabindex='31'>ğŸ¤“</span><span tabindex='32'>ğŸ˜</span><span tabindex='33'>ğŸ¥¸</span>
          <span tabindex='34'>ğŸ¤©</span><span tabindex='35'>ğŸ¥³</span>
          <span tabindex='36'>ğŸ˜</span><span tabindex='37'>ğŸ˜’</span><span tabindex='38'>ğŸ˜</span>
          <span tabindex='39'>ğŸ˜”</span><span tabindex='40'>ğŸ˜Ÿ</span>
        </p>

        <p>
          <span tabindex='41'>ğŸ˜•</span><span tabindex='42'>ğŸ™</span><span tabindex='43'>â˜¹ï¸</span>
          <span tabindex='44'>ğŸ˜£</span><span tabindex='45'>ğŸ˜–</span>
          <span tabindex='46'>ğŸ˜«</span><span tabindex='47'>ğŸ˜©</span><span tabindex='48'>ğŸ¥º</span>
          <span tabindex='49'>ğŸ˜¢</span><span tabindex='50'>ğŸ˜­</span>
        </p>

        <p>
          <span tabindex='51'>ğŸ˜®â€ğŸ’¨</span><span tabindex='52'>ğŸ˜¤</span><span tabindex='53'>ğŸ˜ </span>
          <span tabindex='54'>ğŸ˜¡</span><span tabindex='55'>ğŸ¤¬</span><span tabindex='56'>ğŸ¤¯</span>
          <span tabindex='57'>ğŸ˜³</span><span tabindex='58'>ğŸ¥µ</span><span tabindex='59'>ğŸ¥¶</span>
          <span tabindex='60'>ğŸ˜±</span>
        </p>

        <p>
          <span tabindex='61'>ğŸ˜¨</span><span tabindex='62'>ğŸ˜°</span><span tabindex='63'>ğŸ˜¥</span>
          <span tabindex='64'>ğŸ˜“</span><span tabindex='65'>ğŸ«£</span>
          <span tabindex='66'>ğŸ¤—</span><span tabindex='67'>ğŸ«¡</span><span tabindex='68'>ğŸ¤”</span>
          <span tabindex='69'>ğŸ«¢</span><span tabindex='70'>ğŸ¤­</span>
        </p>
      </div>

    </TabPanel>
    <TabPanel :header='`${t("chat.emoji.face")} 2`'>
      <div class='emoji text-xl'>
        <p>
          <span tabindex='1'>ğŸ¤«</span><span tabindex='2'>ğŸ¤¥</span><span tabindex='3'>ğŸ˜¶</span>
          <span tabindex='4'>ğŸ˜¶â€ğŸŒ«ï¸</span><span tabindex='5'>ğŸ˜</span>
          <span tabindex='6'>ğŸ˜‘</span><span tabindex='7'>ğŸ˜¬</span><span tabindex='8'>ğŸ«¨</span>
          <span tabindex='9'>ğŸ« </span><span tabindex='10'>ğŸ™„</span>
        </p>

        <p>
          <span tabindex='11'>ğŸ˜¯</span><span tabindex='12'>ğŸ˜¦</span><span tabindex='13'>ğŸ˜§</span>
          <span tabindex='14'>ğŸ˜®</span><span tabindex='15'>ğŸ˜²</span>
          <span tabindex='16'>ğŸ¥±</span><span tabindex='17'>ğŸ˜´</span><span tabindex='18'>ğŸ¤¤</span>
          <span tabindex='19'>ğŸ˜ª</span><span tabindex='20'>ğŸ˜µ</span>
        </p>

        <p>
          <span tabindex='21'>ğŸ˜µâ€ğŸ’«</span><span tabindex='22'>ğŸ«¥</span><span tabindex='23'>ğŸ¤</span>
          <span tabindex='24'>ğŸ¥´</span><span tabindex='25'>ğŸ¤¢</span>
          <span tabindex='26'>ğŸ¤®</span><span tabindex='27'>ğŸ¤§</span><span tabindex='28'>ğŸ˜·</span>
          <span tabindex='29'>ğŸ¤’</span><span tabindex='30'>ğŸ¤•</span>
        </p>

        <p>
          <span tabindex='31'>ğŸ¤‘</span><span tabindex='32'>ğŸ¤ </span><span tabindex='33'>ğŸ˜ˆ</span>
          <span tabindex='34'>ğŸ‘¿</span><span tabindex='35'>ğŸ‘¹</span>
          <span tabindex='36'>ğŸ‘º</span><span tabindex='37'>ğŸ¤¡</span><span tabindex='38'>ğŸ’©</span>
          <span tabindex='39'>ğŸ‘»</span><span tabindex='40'>ğŸ’€</span>
        </p>

        <p>
          <span tabindex='41'>â˜ ï¸</span><span tabindex='42'>ğŸ‘½</span><span tabindex='43'>ğŸ‘¾</span>
          <span tabindex='44'>ğŸ¤–</span><span tabindex='45'>ğŸƒ</span>
          <span tabindex='46'>ğŸ˜º</span><span tabindex='47'>ğŸ˜¸</span><span tabindex='48'>ğŸ˜¹</span>
          <span tabindex='49'>ğŸ˜»</span><span tabindex='50'>ğŸ˜¼</span>
        </p>

        <p>
          <span tabindex='51'>ğŸ˜½</span><span tabindex='52'>ğŸ™€</span><span tabindex='53'>ğŸ˜¿</span>
          <span tabindex='54'>ğŸ˜¾</span>
        </p>
      </div>

    </TabPanel>
    <TabPanel :header='t("chat.emoji.body")'>
      <div class='emoji text-xl'>
        <p>
          <span tabindex='1'>ğŸ‘‹</span><span tabindex='2'>ğŸ¤š</span><span tabindex='3'>ğŸ–</span>
          <span tabindex='4'>âœ‹</span><span tabindex='5'>ğŸ––</span>
          <span tabindex='6'>ğŸ‘Œ</span><span tabindex='7'>ğŸ¤Œ</span><span tabindex='8'>ğŸ¤</span>
          <span tabindex='9'>âœŒï¸</span><span tabindex='10'>ğŸ¤</span>
        </p>

        <p>
          <span tabindex='11'>ğŸ«°</span><span tabindex='12'>ğŸ¤Ÿ</span><span tabindex='13'>ğŸ¤˜</span>
          <span tabindex='14'>ğŸ¤™</span><span tabindex='15'>ğŸ«µ</span>
          <span tabindex='16'>ğŸ«±</span><span tabindex='17'>ğŸ«²</span><span tabindex='18'>ğŸ«¸</span>
          <span tabindex='19'>ğŸ«·</span><span tabindex='20'>ğŸ«³</span>
        </p>

        <p>
          <span tabindex='21'>ğŸ«´</span><span tabindex='22'>ğŸ‘ˆ</span><span tabindex='23'>ğŸ‘‰</span>
          <span tabindex='24'>ğŸ‘†</span><span tabindex='25'>ğŸ–•</span>
          <span tabindex='26'>ğŸ‘‡</span><span tabindex='27'>â˜ï¸</span><span tabindex='28'>ğŸ‘</span>
          <span tabindex='29'>ğŸ‘</span><span tabindex='30'>âœŠ</span>
        </p>

        <p>
          <span tabindex='31'>ğŸ‘Š</span><span tabindex='32'>ğŸ¤›</span><span tabindex='33'>ğŸ¤œ</span>
          <span tabindex='34'>ğŸ‘</span><span tabindex='35'>ğŸ«¶</span>
          <span tabindex='36'>ğŸ™Œ</span><span tabindex='37'>ğŸ‘</span><span tabindex='38'>ğŸ¤²</span>
          <span tabindex='39'>ğŸ¤</span><span tabindex='40'>ğŸ™</span>
        </p>

        <p>
          <span tabindex='41'>âœï¸</span><span tabindex='42'>ğŸ’…</span><span tabindex='43'>ğŸ¤³</span>
          <span tabindex='44'>ğŸ’ª</span><span tabindex='45'>ğŸ¦¾</span>
          <span tabindex='46'>ğŸ¦µ</span><span tabindex='47'>ğŸ¦¿</span><span tabindex='48'>ğŸ¦¶</span>
          <span tabindex='49'>ğŸ‘£</span><span tabindex='50'>ğŸ‘‚</span>
        </p>

        <p>
          <span tabindex='51'>ğŸ¦»</span><span tabindex='52'>ğŸ‘ƒ</span><span tabindex='53'>ğŸ«€</span>
          <span tabindex='54'>ğŸ«</span><span tabindex='55'>ğŸ§ </span>
          <span tabindex='56'>ğŸ¦·</span><span tabindex='57'>ğŸ¦´</span><span tabindex='58'>ğŸ‘€</span>
          <span tabindex='59'>ğŸ‘</span><span tabindex='60'>ğŸ‘…</span>
        </p>

        <p>
          <span tabindex='61'>ğŸ‘„</span><span tabindex='62'>ğŸ«¦</span><span tabindex='63'>ğŸ’‹</span>
          <span tabindex='64'>ğŸ©¸</span>
        </p>

      </div>
    </TabPanel>

  </TabView>

</template>

<script setup lang='ts'>
import { onMounted } from 'vue';
import { useI18n } from 'vue-i18n';

const emits = defineEmits(['insertEmoji']);
const { t } = useI18n();
function handleKeyDown(e: KeyboardEvent) {
  if (e.key === 'ArrowDown') {
    focusCurrentEmojiPlus(10);
  }
  if (e.key === 'ArrowUp') {
    focusCurrentEmojiPlus(-10);
  }
  if (e.key === 'ArrowRight') {
    focusCurrentEmojiPlus(1);
  }
  if (e.key === 'ArrowLeft') {
    focusCurrentEmojiPlus(-1);
  }
}

function handleEnter() {
  const element = document.activeElement as HTMLElement;
  if (element?.nodeName === 'SPAN') {
    element?.click();
  }
}

function focusWhenChangeTab() {
  setTimeout(() => {
    focusEmoji(1);
  }, 100);
}

function focusCurrentEmojiPlus(value: number) {
  const element = document.activeElement as HTMLElement;
  if (element?.nodeName === 'SPAN') {
    const currentTabIndex = element?.tabIndex;
    focusEmoji(currentTabIndex + value);
  }
}

function focusEmoji(index: number) {
  const element = document.querySelector<HTMLElement>(`[data-p-active="true"] .emoji p span[tabindex="${ index }"]`);
  element?.focus();
}

onMounted(() => {
  document.querySelectorAll<HTMLElement>('.emoji p span').forEach(
    (e) => {
      e.addEventListener('click', () => {
        emits('insertEmoji', e.innerHTML);
      });
    }
  );
  focusEmoji(1);
});
</script>

<script lang='ts'>
export default { name: 'ChatEmoji' };
</script>

<style lang='scss'>
.emoji {
  p {
    span {
      font-family: Segoe UI Emoji, emoji;
      cursor: pointer;

      &:focus-visible {
        outline: 1px solid var(--primary-color);
      }
    }
  }
}

.p-tabview {
  .p-tabview-panels {
    padding: .5rem 0;
  }
}
</style>